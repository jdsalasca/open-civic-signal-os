# .agentic-rules

version: 2
project: open-civic-signal-os
mission: Transform community signals into transparent, auditable, executable civic backlog.

## 1) Decision Priority (Strict)

1. Correctness and safety
2. Public trust and auditability
3. Determinism and contract stability
4. Test reliability and CI signal quality
5. UX clarity and accessibility
6. Delivery speed

## 2) Scope and Change Budget

- One objective per PR.
- Max one primary subsystem per PR unless explicitly requested:
  - backend api/domain, or
  - frontend workflow/ui, or
  - docs/governance/automation.
- If scope expands, stop and update acceptance criteria before coding.
- Reject scope creep that does not move the active story outcome.

## 3) Architecture and Source of Truth

- Ranking and scoring logic are backend-owned (Java).
- Frontend must display, never redefine ranking formula.
- API response shape changes require OpenAPI updates in the same PR.
- Scoring changes require formula/version traceability in docs and changelog notes.
- `docs/community/current-backlog.md` is weekly execution source of truth.

## 4) Non-Negotiable Prohibitions

Do not commit:

- generated artifacts: `apps/web-react/dist/*`, `apps/web-react/test-results/*`
- local screenshots/audit outputs (`*.png`, `*.jpg`) unless issue explicitly requires artifacts
- temp/editor/cache files and local logs
- malformed docs/config (invalid JSON, broken markdown, malformed bullets)

Do not do:

- bypass or weaken validation (`skipTests` for backend validation is prohibited)
- hidden dependency churn
- undocumented behavior changes
- silent contract drift between backend and frontend

## 5) Dependency Governance

- Default: no new dependencies.
- If needed, PR must include:
  - why native/project-local alternative is insufficient
  - runtime vs dev-only classification
  - security/update footprint
  - rollback/removal plan

## 6) Quality Gates Before Push

Required:

- `npm run agent:preflight`

Conditional:

- If Java backend changed: `mvn -q test` in `apps/api-java`
- If contract changed: run contract/ADR gate and verify OpenAPI consistency
- If docs changed: ensure links/examples are still valid
- If frontend changed: run Playwright CLI visual audit and produce evidence under `output/playwright/`

## 7) Testing and Regression Rules

- Every bugfix must add a regression test.
- Every behavior change must ship with tests and docs in same PR.
- Every trust-critical rule must include deterministic test evidence.
- No flaky-test acceptance without mitigation note and follow-up issue.

## 8) Security, Privacy, and Trust

- Minimize PII collection and exposure.
- Never leak secrets in logs/docs/examples.
- Keep audit metadata explicit: source, timestamp, transformation/version.
- Moderation and trust-critical actions must be explainable and reviewable.
- Prefer fail-closed behavior for invalid or ambiguous input.

## 9) PR Evidence Contract (Mandatory)

PR body must include:

- objective and story/issue ID
- files changed by layer (backend/frontend/contracts/docs)
- commands executed with pass/fail outcome
- risk analysis and rollback plan
- migration impact (`none` when not applicable)
- explicit note if other-agent changes were included
- `UX Evidence (Playwright)` section (mandatory for frontend-impacting PRs; `N/A` must be justified)

## 10) Rejection Criteria

Reject the PR if any is true:

- CI fails or required checks are skipped
- generated artifacts are committed
- contract changed without OpenAPI/ADR alignment
- behavior changed without test evidence
- malformed markdown/json/config introduced
- objective is mixed with unrelated work

## 11) Stop Conditions

Pause and ask for clarification when:

- acceptance criteria conflict with product principles
- breaking change is implied but not approved
- security/privacy impact is uncertain
- contract intent is ambiguous

## 12) Definition of Excellent

A change is excellent only if it is:

- correct
- deterministic
- auditable
- secure
- tested
- documented
- scoped
- reversible

## 13) Visual Value Rule

Visual experience quality is treated as 70% of perceived product value.

- Frontend changes without Playwright CLI evidence are considered incomplete.
- Prefer CLI-first browser automation (`playwright-cli`) over ad-hoc claims.
